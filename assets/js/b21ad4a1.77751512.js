"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2802],{5590:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var i=t(5893),r=t(1151);const o={id:"develop_plugin",description:"How to develop a new plugin",slug:"/plugin/how_to_develop_a_new_plugin"},a="How to develop a new plugin",s={id:"customization/plugin/develop_plugin",title:"How to develop a new plugin",description:"How to develop a new plugin",source:"@site/docs/customization/plugin/how_to_develop_a_new_plugin.md",sourceDirName:"customization/plugin",slug:"/plugin/how_to_develop_a_new_plugin",permalink:"/TaskWeaver/docs/plugin/how_to_develop_a_new_plugin",draft:!1,unlisted:!1,editUrl:"https://github.com/microsoft/TaskWeaver/tree/main/website/docs/customization/plugin/how_to_develop_a_new_plugin.md",tags:[],version:"current",frontMatter:{id:"develop_plugin",description:"How to develop a new plugin",slug:"/plugin/how_to_develop_a_new_plugin"},sidebar:"documentSidebar",previous:{title:"Auto Plugin Selection",permalink:"/TaskWeaver/docs/customization/plugin/plugin_selection"},next:{title:"Multiple YAML files to one Python implementation",permalink:"/TaskWeaver/docs/plugin/multi_yaml_single_impl"}},l={},c=[{value:"Implement the python code",id:"implement-the-python-code",level:2},{value:"Configure the schema",id:"configure-the-schema",level:2},{value:"Call the plugin",id:"call-the-plugin",level:2},{value:"FAQ",id:"faq",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"how-to-develop-a-new-plugin",children:"How to develop a new plugin"}),"\n",(0,i.jsx)(n.p,{children:"In this tutorial, we will introduce how to develop a strawman plugin in TaskWeaver. This plugin can render a input text in ascii art."}),"\n",(0,i.jsx)(n.h2,{id:"implement-the-python-code",children:"Implement the python code"}),"\n",(0,i.jsxs)(n.p,{children:["Create a python file named ",(0,i.jsx)(n.code,{children:"ascii_render.py"})," in the ",(0,i.jsx)(n.code,{children:"plugins"})," folder. The file name should be the same as the plugin name. The plugin name is defined in the plugin schema. In this example, the plugin name is ",(0,i.jsx)(n.code,{children:"ascii_render"}),".\nThe following code is the template of the plugin implementation."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from taskweaver.plugin import Plugin, register_plugin\n\n@register_plugin\nclass PluginTemplate(Plugin):\n    def __call__(self, *args, **kwargs):\n        """Implementation Starts"""\n        result, description = YourImplementation()\n        """Implementation Ends"""\n\n        # if your want to add artifact from the execution result, uncomment the following code\n        # self.ctx.add_artifact(\n        #     name="artifact",\n        #     file_name="artifact.csv",\n        #     type="df",\n        #     val=result,\n        # )\n        return result, description\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The typical way of implementing the plugin is to change the code between ",(0,i.jsx)(n.code,{children:"Implementation Starts"})," and ",(0,i.jsx)(n.code,{children:"Implementation Ends"}),". Note that the return are two variables ",(0,i.jsx)(n.em,{children:"result"})," and ",(0,i.jsx)(n.em,{children:"description"}),". The ",(0,i.jsx)(n.em,{children:"result"})," stores whatever output required for follow-up processing (e.g., a DataFrame). The ",(0,i.jsx)(n.em,{children:"description"})," is a string to describe the result."]}),"\n",(0,i.jsx)(n.p,{children:"Let's make some changes to the code and the result is as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from taskweaver.plugin import Plugin, register_plugin\n\n@register_plugin\nclass AsciiRenderPlugin(Plugin):\n    def __call__(self, text: str):\n        import pyfiglet\n        ascii_art_str = pyfiglet.figlet_format(text, font='isometric1')\n        return ascii_art_str\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note that this function depends on the package ",(0,i.jsx)(n.code,{children:"pyfiglet"}),", so we need to install it with ",(0,i.jsx)(n.code,{children:"pip install pyfiglet"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"configure-the-schema",children:"Configure the schema"}),"\n",(0,i.jsxs)(n.p,{children:["Next, we need to configure the schema so that the LLM can understand the function\nof the plugin. In the schema, there are several fields that should be filled,\nincluding ",(0,i.jsx)(n.code,{children:"name"}),", ",(0,i.jsx)(n.code,{children:"enabled"}),", ",(0,i.jsx)(n.code,{children:"required"}),", ",(0,i.jsx)(n.code,{children:"description"}),", ",(0,i.jsx)(n.code,{children:"parameters"})," and ",(0,i.jsx)(n.code,{children:"returns"}),".\nPlease check ",(0,i.jsx)(n.a,{href:"https://microsoft.github.io/TaskWeaver/docs/plugin/plugin_intro",children:"Plugin Introduction"}),"\nfor more details.\nCreate a yaml file named ",(0,i.jsx)(n.code,{children:"ascii_render.yaml"})," and copy the following content into it."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"name: ascii_render\nenabled: true\nrequired: true\ndescription: >-\n  This plugin renders the input text into ASCII art form. \n  The input should be a string and the output is also a string in ASCII art.\n  For example, result = ascii_render(text='Hello World').\n\nparameters:\n  - name: text\n    type: str\n    required: true\n    description: >-\n      This is the input text to be rendered into ASCII art form.\n\nreturns:\n  - name: result\n    type: str\n    description: >-\n      The rendered text in ASCII art.\n"})}),"\n",(0,i.jsx)(n.h2,{id:"call-the-plugin",children:"Call the plugin"}),"\n",(0,i.jsx)(n.p,{children:"After the plugin is implemented and configured, we can call the plugin in the conversation.\nThe full conversation is as follows:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"=========================================================\n _____         _     _       __\n|_   _|_ _ ___| | _ | |     / /__  ____ __   _____  _____\n  | |/ _` / __| |/ /| | /| / / _ \\/ __ `/ | / / _ \\/ ___/\n  | | (_| \\__ \\   < | |/ |/ /  __/ /_/ /| |/ /  __/ /\n  |_|\\__,_|___/_|\\_\\|__/|__/\\___/\\__,_/ |___/\\___/_/\n=========================================================\nTaskWeaver: I am TaskWeaver, an AI assistant. To get started, could you please enter your request?\nHuman: render ABC in ascii art\n>>> [INIT_PLAN]\n1. Render the text 'ABC' into ASCII art\n>>> [PLAN]\n1. Instruct CodeInterpreter to render the text 'ABC' into ASCII art\n>>> [CURRENT_PLAN_STEP]\n1. Instruct CodeInterpreter to render the text 'ABC' into ASCII art\n>>> [SEND_TO]\nCodeInterpreter\n>>> [MESSAGE]\nPlease render the text 'ABC' into ASCII art\n>>> [PLANNER->CODEINTERPRETER]\nPlease render the text 'ABC' into ASCII art\n>>> [PYTHON]\n# Call the plugin function to render the text 'ABC' into ASCII art\nascii_art_result = ascii_render(\"ABC\")\nascii_art_result\n>>> [VERIFICATION]\nNONE\n>>> [STATUS]\nSUCCESS\n>>> [RESULT]\nThe execution of the generated python code above has succeeded\n\nThe result of above Python code after execution is:\n      ___           ___           ___     \n     /\\  \\         /\\  \\         /\\  \\    \n    /::\\  \\       /::\\  \\       /::\\  \\   \n   /:/\\:\\  \\     /:/\\:\\  \\     /:/\\:\\  \\  \n  /::\\~\\:\\  \\   /::\\~\\:\\__\\   /:/  \\:\\  \\ \n /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:|__| /:/__/ \\:\\__\\\n \\/__\\:\\/:/  / \\:\\~\\:\\/:/  / \\:\\  \\  \\/__/\n      \\::/  /   \\:\\ \\::/  /   \\:\\  \\      \n      /:/  /     \\:\\/:/  /     \\:\\  \\     \n     /:/  /       \\::/__/       \\:\\__\\    \n     \\/__/         ~~            \\/__/    \n\n>>> [CODEINTERPRETER->PLANNER]\nThe following python code has been executed:\n\n# Call the plugin function to render the text 'ABC' into ASCII art\nascii_art_result = ascii_render(\"ABC\")\nascii_art_result\n\n\n\nThe execution of the generated python code above has succeeded\n\nThe result of above Python code after execution is:\n      ___           ___           ___     \n     /\\  \\         /\\  \\         /\\  \\    \n    /::\\  \\       /::\\  \\       /::\\  \\   \n   /:/\\:\\  \\     /:/\\:\\  \\     /:/\\:\\  \\  \n  /::\\~\\:\\  \\   /::\\~\\:\\__\\   /:/  \\:\\  \\ \n /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:|__| /:/__/ \\:\\__\\\n \\/__\\:\\/:/  / \\:\\~\\:\\/:/  / \\:\\  \\  \\/__/\n      \\::/  /   \\:\\ \\::/  /   \\:\\  \\      \n      /:/  /     \\:\\/:/  /     \\:\\  \\     \n     /:/  /       \\::/__/       \\:\\__\\    \n     \\/__/         ~~            \\/__/    \n\n>>> [INIT_PLAN]  \n1. Render the text 'ABC' into ASCII art\n>>> [PLAN]\n1. Instruct CodeInterpreter to render the text 'ABC' into ASCII art\n>>> [CURRENT_PLAN_STEP]\nReport the ASCII art to the user\n>>> [SEND_TO]\nUser\n>>> [MESSAGE]\nHere is the text 'ABC' rendered in ASCII art:\n      ___           ___           ___     \n     /\\  \\         /\\  \\         /\\  \\    \n    /::\\  \\       /::\\  \\       /::\\  \\   \n   /:/\\:\\  \\     /:/\\:\\  \\     /:/\\:\\  \\  \n  /::\\~\\:\\  \\   /::\\~\\:\\__\\   /:/  \\:\\  \\ \n /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:|__| /:/__/ \\:\\__\\\n \\/__\\:\\/:/  / \\:\\~\\:\\/:/  / \\:\\  \\  \\/__/\n      \\::/  /   \\:\\ \\::/  /   \\:\\  \\      \n      /:/  /     \\:\\/:/  /     \\:\\  \\     \n     /:/  /       \\::/__/       \\:\\__\\    \n     \\/__/         ~~            \\/__/    \n>>> [PLANNER->USER]\nHere is the text 'ABC' rendered in ASCII art:\n      ___           ___           ___     \n     /\\  \\         /\\  \\         /\\  \\    \n    /::\\  \\       /::\\  \\       /::\\  \\   \n   /:/\\:\\  \\     /:/\\:\\  \\     /:/\\:\\  \\  \n  /::\\~\\:\\  \\   /::\\~\\:\\__\\   /:/  \\:\\  \\ \n /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:|__| /:/__/ \\:\\__\\\n \\/__\\:\\/:/  / \\:\\~\\:\\/:/  / \\:\\  \\  \\/__/\n      \\::/  /   \\:\\ \\::/  /   \\:\\  \\      \n      /:/  /     \\:\\/:/  /     \\:\\  \\     \n     /:/  /       \\::/__/       \\:\\__\\    \n     \\/__/         ~~            \\/__/    \nTaskWeaver: Here is the text 'ABC' rendered in ASCII art:\n      ___           ___           ___     \n     /\\  \\         /\\  \\         /\\  \\    \n    /::\\  \\       /::\\  \\       /::\\  \\   \n   /:/\\:\\  \\     /:/\\:\\  \\     /:/\\:\\  \\  \n  /::\\~\\:\\  \\   /::\\~\\:\\__\\   /:/  \\:\\  \\ \n /:/\\:\\ \\:\\__\\ /:/\\:\\ \\:|__| /:/__/ \\:\\__\\\n \\/__\\:\\/:/  / \\:\\~\\:\\/:/  / \\:\\  \\  \\/__/\n      \\::/  /   \\:\\ \\::/  /   \\:\\  \\      \n      /:/  /     \\:\\/:/  /     \\:\\  \\     \n     /:/  /       \\::/__/       \\:\\__\\    \n     \\/__/         ~~            \\/__/        \n"})}),"\n",(0,i.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: How do I know if TaskWeaver can see my plugin?"})}),"\n",(0,i.jsx)(n.p,{children:'A: A simple way to check if TaskWeaver can see your plugin is to ask "What can you do?" to TaskWeaver.\nThe typical response is to list all the available plugins like the following:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:"I can assist you with various tasks, including:\n\n- Detecting anomalies in time series data.\n- Rendering text into ASCII art.\n- Searching and comparing prices from thousands of online shops (US only).\n- Telling a joke.\n\nIf you have a specific task in mind, please let me know, and I'll do my best to assist you.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you see your plugin in the list, it means TaskWeaver can see your plugin.\nBut this is not a reliable way to check if TaskWeaver can see your plugin because the response is generated by the LLM.\nA more reliable way is to check the prompt of the Planner. You can find the prompts\nfrom ",(0,i.jsx)(n.code,{children:"project/workspace/sessions/<session_id>/planner_prompt_log_xxxx.yaml"}),".\nThen, search for this section as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:'CodeInterpreter has the following plugin functions and their required parameters need to be provided before the execution:\n- anomaly_detection: anomaly_detection function identifies anomalies from an input DataFrame of time series. It will add a new column \\"Is_Anomaly\\", where each entry will be marked with \\"True\\" if the value is an anomaly or \\"False\\" otherwise. Arguments required: df: DataFrame, time_col_name: str, value_col_name: str\n- ascii_render: This plugin renders the input text into ASCII art form. Arguments required: text: str\n- klarna_search: Search and compare prices from thousands of online shops. Only available in the US. This plugin only takes user requests when searching for merchandise. If not clear, confirm with the user if they want to search for merchandise from Klarna. Arguments required: query: str\n- tell_joke: Call this plugin to tell a joke.\n'})}),"\n",(0,i.jsx)(n.p,{children:"Check if your plugin is in the list. If it is, it means TaskWeaver can see your plugin."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: Why TaskWeaver cannot see my plugin?"})}),"\n",(0,i.jsxs)(n.p,{children:["First, make sure you have read our ",(0,i.jsx)(n.a,{href:"https://microsoft.github.io/TaskWeaver/docs/plugin/plugin_intro",children:"Plugin Introduction"})," and this tutorial carefully.\nYou should have two files in the ",(0,i.jsx)(n.code,{children:"plugins"})," folder, e.g., ",(0,i.jsx)(n.code,{children:"ascii_render.py"})," and ",(0,i.jsx)(n.code,{children:"ascii_render.yaml"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Now, if TaskWeaver cannot see your plugin, the root cause is typically syntax errors in the yaml file.\nCheck the console output if you are using the command line interface, or the console logs if you are using the web interface.\nYou may see the following error message:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"failed to loading component from <name>.yaml, skipping: Yaml loading failed due to: <reason>\n"})}),"\n",(0,i.jsx)(n.p,{children:"The error message will tell you the reason why the yaml file cannot be loaded.\nIt is typically easy to fix the syntax errors by using a yaml linter (e.g., in Visual Studio Code) or an online yaml linter."}),"\n",(0,i.jsxs)(n.p,{children:["If you have checked the syntax of the yaml file and TaskWeaver still cannot see your plugin, please check\nif the yaml file has included all the required fields such as the ",(0,i.jsx)(n.code,{children:"parameters"})," and ",(0,i.jsx)(n.code,{children:"returns"})," fields."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: Why TaskWeaver can see my plugin but cannot call it?"})}),"\n",(0,i.jsx)(n.p,{children:"A: In this case, you may see the generated code has called the plugin function,\nbut the execution result is an error message saying that the plugin function is undefined.\nIf this happens, please check the console output if you are using the command line interface,\nor the console logs if you are using the web interface."}),"\n",(0,i.jsx)(n.p,{children:"You may see the following error message:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"Plugin <name> failed to load: Plugin <name> failed to register: failed to load plugin <name> <reason>\n"})}),"\n",(0,i.jsx)(n.p,{children:"This error message will tell you the reason why the plugin function cannot be loaded.\nIt is typically easy to fix the errors by checking the console output or logs.\nThe root cause is typically errors in the python file that causes the plugin function cannot be loaded.\nTypical errors include syntax errors, missing imports, or missing packages."}),"\n",(0,i.jsx)(n.p,{children:'Note that this sort of error is not caused by the implementation "inside" the plugin function.\nOtherwise, the errors would be caught during the execution of the plugin function,\nnot during the loading of the plugin function.'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Q: How to debug my plugin?"})}),"\n",(0,i.jsxs)(n.p,{children:["A: We are working on a debugging tool to help you debug your plugin. For now, a simple way to debug your plugin is to\ndefine a main function in the python file and run it in your local environment.\nFor example, you can define a main function in ",(0,i.jsx)(n.code,{children:"ascii_render.py"})," as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'if __name__ == "__main__":\n    from taskweaver.plugin.context import temp_context\n\n    with temp_context() as temp_ctx:\n        render = AsciiRenderPlugin(name="ascii_render", ctx=temp_ctx, config={})\n        print(render(text="hello world!"))\n'})}),"\n",(0,i.jsx)(n.p,{children:"In this main function, we create a temporary context and call the plugin function with some input.\nYou need not change the plugin implementation. Just add the main function to the end of the python file.\nThen, run the python file in your local environment. If there are any errors, you can see them in the console output."}),"\n",(0,i.jsxs)(n.p,{children:["If you have the ",(0,i.jsx)(n.code,{children:"configurations"})," section in the yaml file, you can manually set the configurations in the ",(0,i.jsx)(n.code,{children:"config"})," parameter of the plugin constructor.\nWe currently do not read the yaml file, so you need to make sure that the configurations are set correctly in the ",(0,i.jsx)(n.code,{children:"config"})," parameter.\nFor example, if an integer configuration ",(0,i.jsx)(n.code,{children:"max_length"})," is defined in the yaml file, you can set it in the ",(0,i.jsx)(n.code,{children:"config"})," parameter as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'config = {\n    "max_length": 100\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Then, pass the ",(0,i.jsx)(n.code,{children:"config"})," to the plugin constructor. As yaml is type sensitive, you need to make sure that the type of the configuration is correct."]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>a});var i=t(7294);const r={},o=i.createContext(r);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);